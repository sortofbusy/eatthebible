"use strict";var ApplicationConfiguration=function(){var applicationModuleName="lettheword",applicationModuleVendorDependencies=["ngResource","ngCookies","ngTouch","ui.router","ui.bootstrap","ui.utils"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("badges"),ApplicationConfiguration.registerModule("chapters",["cgBusy"]),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("plans"),ApplicationConfiguration.registerModule("users"),angular.module("badges").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Badges","badges","dropdown","/badges(/create)?"),Menus.addSubMenuItem("topbar","badges","List Badges","badges"),Menus.addSubMenuItem("topbar","badges","New Badge","badges/create")}]),angular.module("badges").config(["$stateProvider",function($stateProvider){$stateProvider.state("listBadges",{url:"/badges",templateUrl:"modules/badges/views/list-badges.client.view.html"}).state("createBadge",{url:"/badges/create",templateUrl:"modules/badges/views/create-badge.client.view.html"}).state("viewBadge",{url:"/badges/:badgeId",templateUrl:"modules/badges/views/view-badge.client.view.html"}).state("editBadge",{url:"/badges/:badgeId/edit",templateUrl:"modules/badges/views/edit-badge.client.view.html"})}]),angular.module("badges").controller("BadgesController",["$scope","$stateParams","$location","Authentication","Badges",function($scope,$stateParams,$location,Authentication,Badges){$scope.authentication=Authentication,$scope.create=function(){var badge=new Badges({name:this.name});badge.$save(function(response){$location.path("badges/"+response._id),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(badge){if(badge){badge.$remove();for(var i in $scope.badges)$scope.badges[i]===badge&&$scope.badges.splice(i,1)}else $scope.badge.$remove(function(){$location.path("badges")})},$scope.update=function(){var badge=$scope.badge;badge.$update(function(){$location.path("badges/"+badge._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.badges=Badges.query({user:$scope.authentication.user._id})},$scope.findOne=function(){$scope.badge=Badges.get({badgeId:$stateParams.badgeId})}}]),angular.module("badges").controller("BadgesModalController",["$scope","$modalInstance","Authentication","Badges",function($scope,$modalInstance,Authentication,Badges){$scope.authentication=Authentication,$scope.badges=[],$scope.find=function(){Badges.query({user:$scope.authentication.user._id},function(result){$scope.badges.push(result[0])})},$scope.ok=function(){$modalInstance.close()},$scope.find()}]),angular.module("badges").factory("Badges",["$resource",function($resource){return $resource("badges/:badgeId",{badgeId:"@_id"},{update:{method:"PUT"}})}]),angular.module("chapters").config(["$stateProvider",function($stateProvider){$stateProvider.state("listChapters",{url:"/chapters",templateUrl:"modules/chapters/views/list-chapters.client.view.html"}).state("createChapter",{url:"/chapters/create",templateUrl:"modules/chapters/views/create-chapter.client.view.html"}).state("viewChapter",{url:"/chapters/:chapterId",templateUrl:"modules/chapters/views/view-chapter.client.view.html"}).state("editChapter",{url:"/chapters/:chapterId/edit",templateUrl:"modules/chapters/views/edit-chapter.client.view.html"})}]),angular.module("chapters").controller("ChaptersController",["$scope","$modal","$http","$stateParams","$location","Authentication","Chapters","Users","$q","Plans","BibleText","ReadingPlan","$sce","BibleRef",function($scope,$modal,$http,$stateParams,$location,Authentication,Chapters,Users,$q,Plans,BibleText,ReadingPlan,$sce,BibleRef){$scope.loadingDefer=$q.defer(),$scope.loadingPromise=$scope.loadingDefer.promise,$scope.loaded=!1,$scope.authentication=Authentication,$http.get("/users/me").then(function(response){$scope.user=new Users(response.data)}),$scope.completed=!1,$scope.plans=null,$scope.plansTabs=[],$scope.init=function(){Plans.query({user:$scope.authentication.user._id},function(plans){ReadingPlan.setPlans(plans,0),plans[0]&&$scope.beginPlanPortion()}),$scope.find()},$scope.beginPlanPortion=function(){$scope.completed=!1,$scope.textPromise=ReadingPlan.beginPlanPortion().then(function(response){"completed"===response&&($scope.completed=!0),$scope.chapterText=response,$scope.find()})},$scope.incrementPlan=function(chapterId){$scope.textPromise=ReadingPlan.incrementPlan(chapterId).then(function(response){if("completed"===response&&($scope.completed=!0),response.created){$scope.openBadgesModal();for(var i=0;i<$scope.plans.length;i++)$scope.plans[i]._id===response._id&&$scope.plans.splice(i,1)}$scope.chapterText=response,$scope.plansTabs[ReadingPlan.getPlanSegment()]=!0,$scope.find()})},$scope.changePlan=function(index){$scope.completed=!1,ReadingPlan.setPlanSegment(index),$scope.plansTabs[index]=!0,$scope.textPromise=ReadingPlan.beginPlanPortion().then(function(response){$scope.chapterText=response})},$scope.create=function(params){return $scope.textPromise=$q(function(resolve){params||(params={name:ReadingPlan.getCurrentChapter()});var chapter=new Chapters(params);chapter.plan=ReadingPlan.getCurrentPlan()._id,$scope.alerts=[],chapter.$save(function(response){$scope.incrementPlan(response._id),$scope.alerts.push({type:"success",msg:"Chapter entered",icon:"check-square-o"}),resolve()},function(errorResponse){$scope.alerts.push({type:"danger",msg:"Chapter entry failed",icon:"times"}),resolve()})}),$scope.textPromise},$scope.submitChapterRange=function(name){if($scope.range){var range=$scope.range.split("-"),rangeStart=range[0].trim(),rangeEnd=range[1];$scope.alerts=[],rangeEnd?(rangeEnd=rangeEnd.trim(),$http.get("/range",{params:{rangeStart:rangeStart,rangeEnd:rangeEnd}}).then(function(response){for(var calls=[],i=response.data.rangeStart;i<response.data.rangeEnd;i++)calls.push($scope.create({absoluteChapter:i}));$q.all(calls)},function(err){$scope.alerts.push({type:"danger",msg:"Range entry failed.",icon:"times"})})):$scope.create({name:rangeStart}),$scope.range=""}},$scope.find=function(userId){userId||(userId=$scope.authentication.user._id),Plans.query({user:userId},function(plans){$scope.loaded||$scope.loadingDefer.resolve(),$scope.loaded=!0,$scope.plans=plans},function(error){$scope.loaded||$scope.loadingDefer.resolve(),$scope.loaded=!0})},$scope.moveChapter=function(increment){$scope.chapterText=null,$scope.create({name:ReadingPlan.getCurrentChapter()})},$scope.sceTrust=function(input){return $sce.trustAsHtml(input)},$scope.share=function(input){({message:input,accessToken:$scope.user.additionalProvidersData.facebook.accessToken})},$scope.openPlansModal=function(size){var modalInstance=$modal.open({animation:!0,templateUrl:"modules/plans/views/plan-modal.html",controller:"PlansController",size:size,resolve:{plans:function(){return ReadingPlan.getPlans()},authentication:function(){return $scope.authentication}}});modalInstance.result.then(function(plans){ReadingPlan.setPlans(plans),plans&&$scope.beginPlanPortion()},function(){})},$scope.openBadgesModal=function(size){$modal.open({animation:!0,templateUrl:"modules/badges/views/badge-modal.html",controller:"BadgesModalController",size:"md"})}}]),angular.module("chapters").directive("mydirNavChapter",[function(){return{restrict:"E",templateUrl:"modules/chapters/views/nav-chapter.html"}}]),angular.module("chapters").directive("mydirSelectBible",[function(){return{restrict:"E",transclude:!0,scope:{refBook:"=refBook",refChapter:"=refChapter"},templateUrl:"modules/chapters/views/select-bible.html"}}]),angular.module("chapters").directive("mydirShowChapterText",[function(){return{restrict:"E",templateUrl:"modules/chapters/views/show-chapter-text.html"}}]),angular.module("chapters").directive("stateLoadingIndicator",["$rootScope",function($rootScope){return{restrict:"E",template:'<div data-ng-show="isStateLoading" class="loading-indicator"><div class="loading-indicator-body"><h3 class="loading-title">Loading...</h3><div class="spinner"><i class="fa fa-spin fa-spinner"></i></div></div></div>',replace:!0,link:function(scope,elem,attrs){scope.isStateLoading=!1,$rootScope.$on("$stateChangeStart",function(){scope.isStateLoading=!0}),$rootScope.$on("$stateChangeSuccess",function(){scope.isStateLoading=!1})}}}]),angular.module("chapters").factory("BibleRef",[function(){var service={};return service.books=[{name:"Genesis",chapters:[31,25,24,26,32,22,24,22,29,32,32,20,18,24,21,16,27,33,38,18,34,24,20,67,34,35,46,22,35,43,55,32,20,31,29,43,36,30,23,23,57,38,34,34,28,34,31,22,33,26]},{name:"Exodus",chapters:[22,25,22,31,23,30,25,32,35,29,10,51,22,31,27,36,16,27,25,26,36,31,33,18,40,37,21,43,46,38,18,35,23,35,35,38,29,31,43,38]},{name:"Leviticus",chapters:[17,16,17,35,19,30,38,36,24,20,47,8,59,57,33,34,16,30,37,27,24,33,44,23,55,46,34]},{name:"Numbers",chapters:[54,34,51,49,31,27,89,26,23,36,35,16,33,45,41,50,13,32,22,29,35,41,30,25,18,65,23,31,40,16,54,42,56,29,34,13]},{name:"Deuteronomy",chapters:[46,37,29,49,33,25,26,20,29,22,32,32,18,29,23,22,20,22,21,20,23,30,25,22,19,19,26,68,29,20,30,52,29,12]},{name:"Joshua",chapters:[18,24,17,24,15,27,26,35,27,43,23,24,33,15,63,10,18,28,51,9,45,34,16,33]},{name:"Judges",chapters:[36,23,31,24,31,40,25,35,57,18,40,15,25,20,20,31,13,31,30,48,25]},{name:"Ruth",chapters:[22,23,18,22]},{name:"1 Samuel",chapters:[28,36,21,22,12,21,17,22,27,27,15,25,23,52,35,23,58,30,24,42,15,23,29,22,44,25,12,25,11,31,13]},{name:"2 Samuel",chapters:[27,32,39,12,25,23,29,18,13,19,27,31,39,33,37,23,29,33,43,26,22,51,39,25]},{name:"1 Kings",chapters:[53,46,28,34,18,38,51,66,28,29,43,33,34,31,34,34,24,46,21,43,29,53]},{name:"2 Kings",chapters:[18,25,27,44,27,33,20,29,37,36,21,21,25,29,38,20,41,37,37,21,26,20,37,20,30]},{name:"1 Chronicles",chapters:[54,55,24,43,26,81,40,40,44,14,47,40,14,17,29,43,27,17,19,8,30,19,32,31,31,32,34,21,30]},{name:"2 Chronicles",chapters:[17,18,17,22,14,42,22,18,31,19,23,16,22,15,19,14,19,34,11,37,20,12,21,27,28,23,9,27,36,27,21,33,25,33,27,23]},{name:"Ezra",chapters:[11,70,13,24,17,22,28,36,15,44]},{name:"Nehemiah",chapters:[11,20,32,23,19,19,73,18,38,39,36,47,31]},{name:"Esther",chapters:[22,23,15,17,14,14,10,17,32,3]},{name:"Job",chapters:[22,13,26,21,27,30,21,22,35,22,20,25,28,22,35,22,16,21,29,29,34,30,17,25,6,14,23,28,25,31,40,22,33,37,16,33,24,41,30,24,34,17]},{name:"Psalm",chapters:[6,12,8,8,12,10,17,9,20,18,7,8,6,7,5,11,15,50,14,9,13,31,6,10,22,12,14,9,11,12,24,11,22,22,28,12,40,22,13,17,13,11,5,26,17,11,9,14,20,23,19,9,6,7,23,13,11,11,17,12,8,12,11,10,13,20,7,35,36,5,24,20,28,23,10,12,20,72,13,19,16,8,18,12,13,17,7,18,52,17,16,15,5,23,11,13,12,9,9,5,8,28,22,35,45,48,43,13,31,7,10,10,9,8,18,19,2,29,176,7,8,9,4,8,5,6,5,6,8,8,3,18,3,3,21,26,9,8,24,13,10,7,12,15,21,10,20,14,9,6]},{name:"Proverbs",chapters:[33,22,35,27,23,35,27,36,18,32,31,28,25,35,33,33,28,24,29,30,31,29,35,34,28,28,27,28,27,33,31]},{name:"Ecclesiastes",chapters:[18,26,22,16,20,12,29,17,18,20,10,14]},{name:"Song of Solomon",chapters:[17,17,11,16,16,13,13,14]},{name:"Isaiah",chapters:[31,22,26,6,30,13,25,22,21,34,16,6,22,32,9,14,14,7,25,6,17,25,18,23,12,21,13,29,24,33,9,20,24,17,10,22,38,22,8,31,29,25,28,28,25,13,15,22,26,11,23,15,12,17,13,12,21,14,21,22,11,12,19,12,25,24]},{name:"Jeremiah",chapters:[19,37,25,31,31,30,34,22,26,25,23,17,27,22,21,21,27,23,15,18,14,30,40,10,38,24,22,17,32,24,40,44,26,22,19,32,21,28,18,16,18,22,13,30,5,28,7,47,39,46,64,34]},{name:"Lamentations",chapters:[22,22,66,22,22]},{name:"Ezekiel",chapters:[28,10,27,17,17,14,27,18,11,22,25,28,23,23,8,63,24,32,14,49,32,31,49,27,17,21,36,26,21,26,18,32,33,31,15,38,28,23,29,49,26,20,27,31,25,24,23,35]},{name:"Daniel",chapters:[21,49,30,37,31,28,28,27,27,21,45,13]},{name:"Hosea",chapters:[11,23,5,19,15,11,16,14,17,15,12,14,16,9]},{name:"Joel",chapters:[20,32,21]},{name:"Amos",chapters:[15,16,15,13,27,14,17,14,15]},{name:"Obadiah",chapters:[21]},{name:"Jonah",chapters:[17,10,10,11]},{name:"Micah",chapters:[16,13,12,13,15,16,20]},{name:"Nahum",chapters:[15,13,19]},{name:"Habakkuk",chapters:[17,20,19]},{name:"Zephaniah",chapters:[18,15,20]},{name:"Haggai",chapters:[15,23]},{name:"Zechariah",chapters:[21,13,10,14,11,15,14,23,17,12,17,14,9,21]},{name:"Malachi",chapters:[14,17,18,6]},{name:"Matthew",chapters:[25,23,17,25,48,34,29,34,38,42,30,50,58,36,39,28,27,35,30,34,46,46,39,51,46,75,66,20]},{name:"Mark",chapters:[45,28,35,41,43,56,37,38,50,52,33,44,37,72,47,20]},{name:"Luke",chapters:[80,52,38,44,39,49,50,56,62,42,54,59,35,35,32,31,37,43,48,47,38,71,56,53]},{name:"John",chapters:[51,25,36,54,47,71,53,59,41,42,57,50,38,31,27,33,26,40,42,31,25]},{name:"Acts",chapters:[26,47,26,37,42,15,60,40,43,48,30,25,52,28,41,40,34,28,41,38,40,30,35,27,27,32,44,31]},{name:"Romans",chapters:[32,29,31,25,21,23,25,39,33,21,36,21,14,23,33,27]},{name:"1 Corinthians",chapters:[31,16,23,21,13,20,40,13,27,33,34,31,13,40,58,24]},{name:"2 Corinthians",chapters:[24,17,18,18,21,18,16,24,15,18,33,21,14]},{name:"Galatians",chapters:[24,21,29,31,26,18]},{name:"Ephesians",chapters:[23,22,21,32,33,24]},{name:"Philippians",chapters:[30,30,21,23]},{name:"Colossians",chapters:[29,23,25,18]},{name:"1 Thessalonians",chapters:[10,20,13,18,28]},{name:"2 Thessalonians",chapters:[12,17,18]},{name:"1 Timothy",chapters:[20,15,16,16,25,21]},{name:"2 Timothy",chapters:[18,26,17,22]},{name:"Titus",chapters:[16,15,15]},{name:"Philemon",chapters:[25]},{name:"Hebrews",chapters:[14,18,19,16,14,20,28,13,28,39,40,29,25]},{name:"James",chapters:[27,26,18,17,20]},{name:"1 Peter",chapters:[25,25,22,19,14]},{name:"2 Peter",chapters:[21,22,18]},{name:"1 John",chapters:[10,29,24,21,21]},{name:"2 John",chapters:[13]},{name:"3 John",chapters:[14]},{name:"Jude",chapters:[25]},{name:"Revelation",chapters:[20,29,22,11,14,17,17,13,21,11,19,17,18,20,8,21,18,24,21,15,27,21]}],service.chapterNameFromId=function(chapterId){for(var chaptersRemaining=chapterId,i=0;i<service.books.length;i++){var chaptersInNextBook=service.books[i].chapters.length;if(!(chaptersRemaining-chaptersInNextBook>0))return service.books[i].name+" "+chaptersRemaining;chaptersRemaining-=chaptersInNextBook}return"Chapter not recognized."},service.chapterIdFromName=function(chapterName){var chapterParts=chapterName.split(" ");chapterParts.length>2&&(chapterParts[0]+=" "+chapterParts[1],chapterParts[1]=chapterParts[2]);for(var chapters=0,i=0;i<service.books.length;i++){if(service.books[i].name===chapterParts[0]){var returnValue=chapters+Number(chapterParts[1]);if(returnValue>0&&1189>=returnValue)return returnValue;break}chapters+=service.books[i].chapters.length}return"Chapter not recognized."},service}]),angular.module("chapters").factory("BibleText",["$q","$http","Authentication",function($q,$http,Authentication){var bibleVersions=[{language:"Afrikaans",name:"Ou Vertaling",code:"aov"},{language:"Albanian",name:"Albanian",code:"albanian"},{language:"Amharic",name:"Haile Selassie Amharic Bible",code:"hsab"},{language:"Arabic",name:"Smith and Van Dyke",code:"arabicsv"},{language:"Chinese",name:"NCV Traditional",code:"cnt"},{language:"Chinese",name:"Union Simplified",code:"cus"},{language:"Chinese",name:"NCV Simplified",code:"cns"},{language:"Chinese",name:"Union Traditional",code:"cut"},{language:"Croatian",name:"Croatian",code:"croatia"},{language:"Danish",name:"Danish",code:"danish"},{language:"Dutch",name:"Dutch Staten Vertaling",code:"statenvertaling"},{language:"English",name:"American Standard Version",code:"asv"},{language:"English",name:"Amplified Version",code:"amp"},{language:"English",name:"Basic English Bible",code:"basicenglish"},{language:"English",name:"Darby",code:"darby"},{language:"English",name:"King James Version",code:"kjv"},{language:"English",name:"KJV Easy Read",code:"akjv"},{language:"English",name:"New American Standard",code:"nasb"},{language:"English",name:"Recovery Version",code:"rcv"},{language:"English",name:"Young's Literal Translation",code:"ylt"},{language:"English",name:"World English Bible",code:"web"},{language:"English",name:"Webster's Bible",code:"wb"},{language:"Esperanto",name:"Esperanto",code:"esperanto"},{language:"Estonian",name:"Estonian",code:"estonian"},{language:"Finnish",name:"Finnish Bible (1776)",code:"finnish1776"},{language:"French",name:"Martin (1744)",code:"martin"},{language:"German",name:"Luther (1912)",code:"luther1912"},{language:"Greek",name:"Greek Modern",code:"moderngreek"},{language:"Greek",name:"Textus Receptus",code:"text"},{language:"Hebrew",name:"Aleppo Codex",code:"aleppo"},{language:"Hungarian",name:"Hungarian Karoli",code:"karoli"},{language:"Italian",name:"Giovanni Diodati Bible (1649)",code:"giovanni"},{language:"Korean",name:"Korean",code:"korean"},{language:"Norwegian",name:"Bibelselskap (1930)",code:"bibelselskap"},{language:"Portuguese",name:"Almeida Atualizada",code:"almeida"},{language:"Russian",name:"Synodal Translation (1876)",code:"synodal"},{language:"Spanish",name:"Reina Valera (1909)",code:"valera"},{language:"Swahili",name:"Swahili",code:"swahili"},{language:"Swedish",name:"Swedish (1917)",code:"swedish"},{language:"Turkish",name:"Turkish",code:"turkish"},{language:"Vietnamese",name:"Vietnamese (1934)",code:"vietnamese"},{language:"Xhosa",name:"Xhosa",code:"xhosa"}],getRCVText=function(chapterName,increment){return $q(function(resolve){$http.get("/reference",{params:{chapterName:chapterName,increment:increment}}).then(function(response){for(var calls=[],i=0;i<response.data.length;i++){var lsmApiConfig={params:{String:response.data[i],Out:"json"}};calls.push($http.get("https://api.lsm.org/recver.php",lsmApiConfig))}$q.all(calls).then(function(result){var combined={};combined.verses=[],combined.inputstring=result[0].data.inputstring.split(":")[0];for(var i=0;i<result.length;i++)combined.verses=combined.verses.concat(result[i].data.verses);for(i=0;i<combined.verses.length;i++)combined.verses[i].text=combined.verses[i].text.split("[").join("<i>"),combined.verses[i].text=combined.verses[i].text.split("]").join("</i>"),combined.verses[i].ref=combined.verses[i].ref.split(":")[1];combined.copyright=result[0].data.copyright,resolve(combined)},function(error){resolve(error)})})})},getGetBibleText=function(chapterName,version){return $q(function(resolve){$http.jsonp("https://getbible.net/json",{params:{scripture:chapterName,v:version,callback:"JSON_CALLBACK"}}).then(function(response){var json=response.data,userVersion={};userVersion.version=version;for(var b=0;b<bibleVersions.length;b++)bibleVersions[b].code===version&&(userVersion=bibleVersions[b]);var combined={};combined.verses=[];try{combined.inputstring=json.book_name+" "+json.chapter_nr;for(var i in json.chapter)combined.verses.push({ref:json.chapter[i].verse_nr,text:json.chapter[i].verse})}catch(e){return void resolve(e)}combined.copyright=userVersion.name+" ["+userVersion.language+"] text from getbible.net.",resolve(combined)},function(error){resolve(error)})})};return{getChapterText:function(chapterName,increment){var version=Authentication.user.preferences.version;return $q("rcv"===version?function(resolve){resolve(getRCVText(chapterName,increment))}:function(resolve){resolve(getGetBibleText(chapterName,version))})}}}]),angular.module("chapters").factory("Chapters",["$resource","$http","$q",function($resource,$http,$q){var chapterFactory=$resource("chapters/:chapterId",{chapterId:"@_id"},{update:{method:"PUT"}});return chapterFactory}]),angular.module("chapters").factory("ReadingPlan",["$http","$q","BibleText","Plans","Badges",function($http,$q,BibleText,Plans,Badges){var service={},plans=[],planSegment=0,readingPace=0,chaptersInPortion=[],currentChapter="";return service.getCurrentPlan=function(){return plans[planSegment]},service.setPlans=function(_plans,_planSegment){plans=_plans,planSegment=_planSegment?_planSegment:0},service.getPlans=function(){return plans},service.getPlanSegment=function(){return planSegment},service.setPlanSegment=function(_planSegment){planSegment=_planSegment},service.getCurrentChapter=function(){return currentChapter},service.getChapterText=function(){return $q(function(resolve){$http.get("/reference",{params:{chapterNumber:chaptersInPortion[0]}}).then(function(response){currentChapter=response.data,resolve(BibleText.getChapterText(currentChapter,0))})})},service.beginPlanPortion=function(){return $q(function(resolve){if(!plans.length)return void resolve();readingPace=0,chaptersInPortion=[];var i=planSegment,planChaptersReadToday=plans[i].chapters?plans[i].chapters.length:0;if(planChaptersReadToday<plans[i].pace){readingPace+=plans[i].pace;for(var p=0;p<plans[i].pace-planChaptersReadToday;p++)p+plans[i].cursor<plans[i].endChapter&&chaptersInPortion.push(p+plans[i].cursor)}else for(var k=plans[i].cursor;k<=plans[i].endChapter;k++)chaptersInPortion.push(k);return 0===chaptersInPortion.length?void resolve("completed"):void resolve(service.getChapterText())})},service.incompletePlan=function(){for(var i=0;i<plans.length;i++){var planChaptersReadToday=plans[i].chapters?plans[i].chapters.length:0;if(planChaptersReadToday<plans[i].pace)return i}return null},service.planEnded=function(){var plan=angular.copy(plans[planSegment]);if(plan.cursor>=plan.endChapter){var badge=new Badges({name:plan.name,created:plan.created,user:plan.user,startChapter:plan.startChapter,endChapter:plan.endChapter});return badge.$save(),!0}return!1},service.incrementPlan=function(chapterId){return $q(function(resolve){service.addChapter(chapterId).then(function(){var plan=plans[planSegment];if(chaptersInPortion.shift(),0===chaptersInPortion.length){var incompletePlan=service.incompletePlan();if(service.planEnded()){var newPlan=angular.copy(plan);return plans.splice(planSegment,1),planSegment=service.incompletePlan(),void newPlan.$remove().then(function(newPlan){resolve(newPlan)})}return planSegment+=1,console.log("done reading "+plan.name+" today, going to plan # "+planSegment),null===incompletePlan?(console.log("all reading plans finished for today!"),planSegment=0,void resolve("completed")):(null!==incompletePlan&&(planSegment=incompletePlan),void resolve(service.beginPlanPortion()))}resolve(service.getChapterText())})})},service.addChapter=function(chapterId){return $q(function(resolve){var plan=plans[planSegment];plan.cursor+=1,plan.chapters.push(chapterId),plan.$update(function(response){plans[planSegment]=response,resolve()})})},service}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function($scope,Authentication,Menus){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("plans").config(["$stateProvider",function($stateProvider){$stateProvider.state("listPlans",{url:"/plans",templateUrl:"modules/plans/views/list-plans.client.view.html"}).state("createPlan",{url:"/plans/create",templateUrl:"modules/plans/views/create-plan.client.view.html"}).state("viewPlan",{url:"/plans/:planId",templateUrl:"modules/plans/views/view-plan.client.view.html"}).state("editPlan",{url:"/plans/:planId/edit",templateUrl:"modules/plans/views/edit-plan.client.view.html"})}]),angular.module("plans").controller("PlansControllerCrud",["$scope","$modal","$stateParams","$location","Authentication","Plans","$window",function($scope,$modal,$stateParams,$location,Authentication,Plans,$window){$scope.authentication=Authentication,Plans.query({user:$scope.authentication.user._id}).$promise.then(function(response){$scope.plans=response}),$scope.create=function(){var plan=new Plans({name:this.name});plan.$save(function(response){$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.update=function(){var plan=$scope.plan;plan.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.plans=Plans.query({user:$scope.authentication.user._id})},$scope.findOne=function(){$scope.plan=Plans.get({planId:$stateParams.planId})}}]),angular.module("plans").controller("PlansController",["$scope","$http","$modalInstance","plans","authentication","Plans","$window","BibleRef",function($scope,$http,$modalInstance,plans,authentication,Plans,$window,BibleRef){$scope.plans=plans,$scope.authentication=authentication,$scope.selected={item:null},$scope.alerts=[],$scope.updateAlerts=[],$scope.items=[{name:"Whole Bible (1 year)",plans:[{name:"Old Testament (1 year)",startChapter:1,endChapter:929,cursor:1,pace:3},{name:"New Testament (1 year)",startChapter:930,endChapter:1189,cursor:930,pace:1}]},{name:"New Testament (6 months)",plans:[{name:"New Testament (6 months)",startChapter:930,endChapter:1189,cursor:930,pace:2}]}],$scope.ok=function(){$modalInstance.close($scope.plans)},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.closeUpdateAlert=function(index){$scope.updateAlerts.splice(index,1)},$scope.myCreate=function(passedPlan){var plan=new Plans(passedPlan);plan.$save(function(response){$scope.alerts.push({msg:"Plan saved!",type:"success"})},function(errorResponse){$scope.alerts.push({msg:errorResponse.data.message,type:"danger"})})},$scope.createMultiple=function(item){for(var i=0;i<item.plans.length;i++){for(var exists=!1,j=0;j<$scope.plans.length;j++)$scope.plans[j].name===item.plans[i].name&&(exists=!0);exists?$scope.alerts.push({msg:"You're already using this plan.",type:"danger"}):$scope.myCreate(item.plans[i])}$scope.selected=null,$scope.find()},$scope.setPlan=function(plan){$scope.startChapter=BibleRef.chapterNameFromId(plan.startChapter),$scope.endChapter=BibleRef.chapterNameFromId(plan.endChapter),$scope.cursor=BibleRef.chapterNameFromId(plan.cursor),$scope.pace=plan.pace},$scope.updatePlan=function(planIndex){$scope.pace=this.pace,$http.get("/reference",{params:{chapterInput:[this.cursor,this.startChapter,this.endChapter]}}).then(function(response){var cursorId=response.data[0],startChapterId=response.data[1],endChapterId=response.data[2];if(angular.isNumber(cursorId)&&angular.isNumber(startChapterId)&&angular.isNumber(endChapterId)&&cursorId>=startChapterId&&endChapterId>=cursorId){var plan=$scope.plans[planIndex];plan.cursor=cursorId,plan.startChapter=startChapterId,plan.endChapter=endChapterId,plan.pace=$scope.pace,plan.$update(function(response){$scope.plans[planIndex]=response,$scope.setPlan($scope.plans[planIndex]),$scope.updateAlerts.push({msg:"Plan updated.",type:"success"})},function(errorResponse){$scope.updateAlerts.push({msg:errorResponse.data.message,type:"danger"})})}else $scope.updateAlerts.push({msg:"Invalid input.",type:"danger"}),this.cursor=$scope.cursor,this.startChapter=$scope.startChapter,this.endChapter=$scope.endChapter},function(error){$scope.updateAlerts.push({msg:"Invalid input.",type:"danger"})})},$scope.remove=function(plan){var areYouSure=$window.confirm("Are you absolutely sure you want to delete this plan? All progress will be permanently lost.");if(plan&&areYouSure){plan.$remove();for(var i in $scope.plans)$scope.plans[i]===plan&&$scope.plans.splice(i,1)}},$scope.find=function(){$scope.plans=Plans.query({user:$scope.authentication.user._id})}}]),angular.module("plans").factory("Plans",["$resource",function($resource){return $resource("plans/:planId",{planId:"@_id"},{update:{method:"PUT"},readToday:{method:"GET",url:"plans/:planId/today",isArray:!0}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"
}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.bibleVersions=[{language:"Afrikaans",name:"Ou Vertaling",code:"aov"},{language:"Albanian",name:"Albanian",code:"albanian"},{language:"Amharic",name:"Haile Selassie Amharic Bible",code:"hsab"},{language:"Arabic",name:"Smith and Van Dyke",code:"arabicsv"},{language:"Chinese",name:"NCV Traditional",code:"cnt"},{language:"Chinese",name:"Union Simplified",code:"cus"},{language:"Chinese",name:"NCV Simplified",code:"cns"},{language:"Chinese",name:"Union Traditional",code:"cut"},{language:"Croatian",name:"Croatian",code:"croatia"},{language:"Danish",name:"Danish",code:"danish"},{language:"Dutch",name:"Dutch Staten Vertaling",code:"statenvertaling"},{language:"English",name:"American Standard Version",code:"asv"},{language:"English",name:"Amplified Version",code:"amp"},{language:"English",name:"Basic English Bible",code:"basicenglish"},{language:"English",name:"Darby",code:"darby"},{language:"English",name:"King James Version",code:"kjv"},{language:"English",name:"KJV Easy Read",code:"akjv"},{language:"English",name:"New American Standard",code:"nasb"},{language:"English",name:"Recovery Version",code:"rcv"},{language:"English",name:"Young's Literal Translation",code:"ylt"},{language:"English",name:"World English Bible",code:"web"},{language:"English",name:"Webster's Bible",code:"wb"},{language:"Esperanto",name:"Esperanto",code:"esperanto"},{language:"Estonian",name:"Estonian",code:"estonian"},{language:"Finnish",name:"Finnish Bible (1776)",code:"finnish1776"},{language:"French",name:"Martin (1744)",code:"martin"},{language:"German",name:"Luther (1912)",code:"luther1912"},{language:"Greek",name:"Greek Modern",code:"moderngreek"},{language:"Greek",name:"Textus Receptus",code:"text"},{language:"Hebrew",name:"Aleppo Codex",code:"aleppo"},{language:"Hungarian",name:"Hungarian Karoli",code:"karoli"},{language:"Italian",name:"Giovanni Diodati Bible (1649)",code:"giovanni"},{language:"Korean",name:"Korean",code:"korean"},{language:"Norwegian",name:"Bibelselskap (1930)",code:"bibelselskap"},{language:"Portuguese",name:"Almeida Atualizada",code:"almeida"},{language:"Russian",name:"Synodal Translation (1876)",code:"synodal"},{language:"Spanish",name:"Reina Valera (1909)",code:"valera"},{language:"Swahili",name:"Swahili",code:"swahili"},{language:"Swedish",name:"Swedish (1917)",code:"swedish"},{language:"Turkish",name:"Turkish",code:"turkish"},{language:"Vietnamese",name:"Vietnamese (1934)",code:"vietnamese"},{language:"Xhosa",name:"Xhosa",code:"xhosa"}],$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);